<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Portfolio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="top-bar"><h1>Portfolio-indl√¶g</h1><a href="create.html" class="create-btn">Opret Nyt Indl√¶g</a></div>
        <div id="filter-controls"><div><label for="search-input">S√∏g</label><input type="search" id="search-input" placeholder="Indtast s√∏geord"></div><div><label for="filter-subject">Filtr√©r efter fag</label><select id="filter-subject"><option value="all">Alle fag</option><option value="Cyber Security">Cyber Security</option><option value="Appudvikling">Appudvikling</option><option value="Andet">Andet</option></select></div><div><label for="start-date">Startdato</label><input type="date" id="start-date"></div><div><label for="end-date">Slutdato</label><input type="date" id="end-date"></div></div>
        <div id="portfolio-list"></div>
    </div>

    <script type="module">
        import { formatDate, getSubjectIcon, typeTranslations } from './main.js';

        document.addEventListener('DOMContentLoaded', () => {
            const portfolioList = document.getElementById('portfolio-list');
            const searchInput = document.getElementById('search-input');
            const filterSubject = document.getElementById('filter-subject');
            const startDateFilter = document.getElementById('start-date');
            const endDateFilter = document.getElementById('end-date');
            let portfolioEntries = JSON.parse(localStorage.getItem('portfolioEntries')) || [];

            const renderEntries = () => {
                const filteringLogic = entry => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const selectedSubject = filterSubject.value;
                    const startDate = startDateFilter.value;
                    const endDate = endDateFilter.value;
                    const matchesSearch = searchTerm === '' || entry.title.toLowerCase().includes(searchTerm) || entry.goal.toLowerCase().includes(searchTerm) || entry.description.toLowerCase().includes(searchTerm);
                    const matchesSubject = selectedSubject === 'all' || entry.subject === selectedSubject;
                    const matchesDate = (!startDate || entry.date >= startDate) && (!endDate || entry.date <= endDate);
                    return matchesSearch && matchesSubject && matchesDate;
                };
                const filteredEntries = portfolioEntries.filter(filteringLogic).sort((a, b) => new Date(b.date) - new Date(a.date));
                portfolioList.innerHTML = filteredEntries.length === 0 ? '<p>Ingen indl√¶g fundet, der matcher dine kriterier.</p>' : '';
                filteredEntries.forEach(entry => {
                    const entryElement = document.createElement('div');
                    entryElement.classList.add('portfolio-entry');
                    entryElement.setAttribute('data-id', entry.id);
                    entryElement.innerHTML = `
                            <div class="entry-header"><div class="entry-header-info"><h3>${entry.title}</h3><div class="entry-meta"><span>üìÖ ${formatDate(entry.date)}</span><span>${getSubjectIcon(entry.subject)} ${entry.subject}</span></div><div class="entry-goal"><div class="entry-section-title">M√•l</div><p>${entry.goal.replace(/\n/g, '<br>')}</p></div></div></div>
                            <div class="entry-details">${entry.description ? `<div class="entry-section-title">Beskrivelse</div><p>${entry.description.replace(/\n/g, '<br>')}</p>` : ''}${entry.code ? `<button class="toggle-btn toggle-content-btn" data-type="code">Vis ${typeTranslations.code}</button><div class="collapsible-content" data-type="code"><pre><code>${entry.code.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre></div>` : ''}${entry.picture ? `<button class="toggle-btn toggle-content-btn" data-type="picture">Vis ${typeTranslations.picture}</button><div class="collapsible-content" data-type="picture"><img src="${entry.picture}" alt="${entry.title} Picture"></div>` : ''}${entry.video ? `<button class="toggle-btn toggle-content-btn" data-type="video">Vis ${typeTranslations.video}</button><div class="collapsible-content" data-type="video"><video controls src="${entry.video}"></video></div>` : ''}</div>
                            <div class="entry-actions"><a href="edit.html?id=${entry.id}" class="edit-btn" title="Rediger Indl√¶g">Rediger</a></div>
                        `;
                    portfolioList.appendChild(entryElement);
                });
            };

            portfolioList.addEventListener('click', (e) => {
                const target = e.target;
                const entryElement = target.closest('.portfolio-entry');
                if (!entryElement) return;

                // H√•ndterer knapper inde i kortet (Vis Kode, Rediger osv.)
                if (target.closest('button, a')) {
                    if (target.matches('.toggle-content-btn')) {
                        const type = target.dataset.type;
                        const translatedType = typeTranslations[type] || type;
                        const detailsContainer = entryElement.querySelector('.entry-details');
                        const content = detailsContainer.querySelector(`.collapsible-content[data-type="${type}"]`);

                        // Skift synlighed p√• indholdet
                        content.classList.toggle('visible');

                        // Opdater knap-tekst
                        target.textContent = content.classList.contains('visible') ? `Skjul ${translatedType}` : `Vis ${translatedType}`;

                        // -- DEN NYE RETTELSE --
                        // Genberegn h√∏jden p√• containeren for at give plads til det nye indhold.
                        // Vi tjekker, at containeren er √•ben, f√∏r vi justerer h√∏jden.
                        if (detailsContainer.style.height !== '0px') {
                            detailsContainer.style.height = detailsContainer.scrollHeight + 'px';
                        }
                    }
                    return; // Stop videre behandling
                }

                // H√•ndterer selve udvid/skjul-animationen af hele kortet
                const details = entryElement.querySelector('.entry-details');
                if (details.style.height && details.style.height !== '0px') {
                    details.style.height = '0px';
                } else {
                    const scrollHeight = details.scrollHeight;
                    details.style.height = scrollHeight + 'px';
                }
            });

            // Resten af event listeners er u√¶ndrede
            startDateFilter.addEventListener('change', () => { endDateFilter.min = startDateFilter.value; renderEntries(); });
            endDateFilter.addEventListener('change', () => { startDateFilter.max = endDateFilter.value; renderEntries(); });
            searchInput.addEventListener('input', renderEntries);
            filterSubject.addEventListener('change', renderEntries);

            renderEntries();
        });
    </script>
</body>
</html>